<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.metroui.org.ua/current/metro.css" />
  <link rel="stylesheet" href="/Css/StyleProfile.css" />
  <title>Mi Perfil</title>

  
</head>

<body>

  <div class="modal fade" id="configModal" tabindex="-1" aria-labelledby="configModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form class="modal-content" action="/users/edit/<%= user.id %>?_method=PUT" method="POST" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title" id="configModalLabel" style="color: black;">Editar Perfil</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="first_name" class="form-label" style="color: black;">Nombre</label>
            <input type="text" class="form-control" id="first_name" name="first_name" value="<%= user.first_name %>" required>
          </div>
          <div class="mb-3">
            <label for="last_name" class="form-label" style="color: black;">Apellido</label>
            <input type="text" class="form-control" id="last_name" name="last_name" value="<%= user.last_name %>" required>
          </div>
          <div class="mb-3">
            <label for="email" class="form-label" style="color: black;">Correo electrónico</label>
            <input type="email" class="form-control" id="email" name="email" value="<%= user.email %>" required>
          </div>
          <div class="mb-3">
            <label for="password" class="form-label" style="color: black;">Contraseña (dejar vacío si no se cambia)</label>
            <input type="password" class="form-control" id="password" name="password">
          </div>
          <div class="mb-3">
            <label for="avatar" class="form-label" style="color: black;">Imagen de perfil</label>
            <input type="file" class="form-control" id="avatar" name="avatar" accept="image/*">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar cambios</button>
        </div>
      </form>
    </div>
  </div>

  <header>
    <div class="hsup">
      <a href="/"><img src="/Images/logo provisorio.png" alt="Logo de la empresa" class="logo" /></a>
    </div>
  </header>

  <main>
    <div class="centerRegister">
      <div class="center">
        <div class="elementRegister">
          <div class="user">
            <img src="/images/users/<%= user.avatar %>" class="imgUser" alt="Foto de usuario" />

          </div>
        </div>
        <div class="elementRegister">
          <label class="textLogin">Nombre</label>
          <p class="imputLogin"><%= user.first_name %> <%= user.last_name %></p>
        </div>
        <div class="elementRegister">
          <label class="textLogin">Email</label>
          <p class="imputLogin"><%= user.email %></p>
        </div>
        <div class="elementRegister">
          <label class="textLogin">Rol</label>
          <p class="imputLogin"><%= user.role %></p>
        </div>
        <div class="acciones-perfil">
          <form action="/users/logout" method="POST">
            <button type="submit">Cerrar sesión</button>
          </form>

          <button type="button" data-bs-toggle="modal" data-bs-target="#configModal">
            <i class="fa-solid fa-gear"></i> Configuración
          </button>

          <form id="deleteForm" action="/users/delete/<%= user.id %>?_method=DELETE" method="POST">
            <button type="button" onclick="confirmDelete()">Eliminar cuenta</button>
          </form>

          <script>
            function confirmDelete() {
              const input = prompt("Escribí CONFIRMAR para eliminar tu cuenta:");
              if (input === "CONFIRMAR") {
                document.getElementById("deleteForm").submit();
              } else {
                alert("Cancelado");
              }
            }
          </script>

          <div class="elementRegister">
            <a href="/" class="btn btn-secondary">Volver al inicio</a>
          </div>
        </div>
      </div>
    </div>
  </main>

  <%- include('../Partials/footer') %>

  <script src="https://cdn.metroui.org.ua/current/metro.js"></script>
  <script src="https://kit.fontawesome.com/814cd6b91c.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
